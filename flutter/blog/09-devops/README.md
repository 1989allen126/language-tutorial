# ğŸš€ Flutter DevOps æ·±åº¦æŒ‡å—

> å…¨é¢çš„ Flutter åº”ç”¨ DevOps è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›– CI/CDã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€åº”ç”¨åˆ†å‘ã€ç›‘æ§è¿ç»´ç­‰ä¼ä¸šçº§å®è·µ

![Flutter DevOps](https://img.shields.io/badge/Flutter-DevOps-blue?style=for-the-badge&logo=flutter)
![Version](https://img.shields.io/badge/Version-3.0.0-green?style=for-the-badge)
![License](https://img.shields.io/badge/License-MIT-yellow?style=for-the-badge)

## ğŸ“‹ ç›®å½•å¯¼èˆª

<details>
<summary>ğŸ¯ å¿«é€Ÿå¯¼èˆª</summary>

### ğŸ”„ CI/CD æµæ°´çº¿

- [ğŸ”„ æŒç»­é›†æˆ](continuous-integration.md) - GitHub Actionsã€GitLab CIã€Jenkins é…ç½®
- [ğŸš€ æŒç»­éƒ¨ç½²](continuous-deployment.md) - è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç¯å¢ƒç®¡ç†ã€å›æ»šç­–ç•¥
- [ğŸ“Š ä»£ç è´¨é‡](code-quality.md) - é™æ€åˆ†æã€ä»£ç è¦†ç›–ç‡ã€è´¨é‡é—¨ç¦
- [âš¡ æ„å»ºä¼˜åŒ–](build-optimization.md) - æ„å»ºç¼“å­˜ã€å¹¶è¡Œæ„å»ºã€å¢é‡æ„å»º

### ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•

- [ğŸ§ª æµ‹è¯•ç­–ç•¥](testing-strategy.md) - æµ‹è¯•é‡‘å­—å¡”ã€æµ‹è¯•åˆ†å±‚ã€æµ‹è¯•è®¡åˆ’
- [ğŸ”¬ å•å…ƒæµ‹è¯•](unit-testing.md) - Widget æµ‹è¯•ã€Mockã€æµ‹è¯•è¦†ç›–ç‡
- [ğŸ”— é›†æˆæµ‹è¯•](integration-testing.md) - ç«¯åˆ°ç«¯æµ‹è¯•ã€API æµ‹è¯•ã€æ•°æ®åº“æµ‹è¯•
- [ğŸ¨ UI æµ‹è¯•](ui-testing.md) - è‡ªåŠ¨åŒ– UI æµ‹è¯•ã€æˆªå›¾å¯¹æ¯”ã€è·¨å¹³å°æµ‹è¯•

### ğŸ“± åº”ç”¨åˆ†å‘

- [ğŸ“± å¤šå¹³å°å‘å¸ƒ](multi-platform-release.md) - iOS App Storeã€Google Playã€åä¸ºåº”ç”¨å¸‚åœº
- [ğŸ§ª å†…æµ‹åˆ†å‘](beta-distribution.md) - TestFlightã€Firebase App Distributionã€è’²å…¬è‹±
- [ğŸ“‹ ç‰ˆæœ¬ç®¡ç†](version-management.md) - è¯­ä¹‰åŒ–ç‰ˆæœ¬ã€åˆ†æ”¯ç­–ç•¥ã€å‘å¸ƒæµç¨‹
- [ğŸ”¥ çƒ­æ›´æ–°](hot-update.md) - CodePushã€è‡ªå®šä¹‰çƒ­æ›´æ–°æ–¹æ¡ˆ

### ğŸ“Š ç›‘æ§è¿ç»´

- [ğŸ“Š åº”ç”¨ç›‘æ§](app-monitoring.md) - æ€§èƒ½ç›‘æ§ã€é”™è¯¯è¿½è¸ªã€ç”¨æˆ·è¡Œä¸ºåˆ†æ
- [ğŸ“ æ—¥å¿—ç®¡ç†](log-management.md) - æ—¥å¿—æ”¶é›†ã€åˆ†æã€å‘Šè­¦
- [âš¡ æ€§èƒ½åˆ†æ](performance-analysis.md) - APM å·¥å…·ã€æ€§èƒ½æŒ‡æ ‡ã€ä¼˜åŒ–å»ºè®®
- [ğŸš¨ å‘Šè­¦é€šçŸ¥](alerting.md) - ç›‘æ§å‘Šè­¦ã€é€šçŸ¥æ¸ é“ã€äº‹ä»¶å“åº”

### ğŸ—ï¸ åŸºç¡€è®¾æ–½ç®¡ç†

- [ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²](containerization.md) - Dockerã€Kubernetesã€å¾®æœåŠ¡æ¶æ„
- [â˜ï¸ äº‘åŸç”Ÿå®è·µ](cloud-native.md) - äº‘æœåŠ¡é›†æˆã€Serverlessã€è¾¹ç¼˜è®¡ç®—
- [ğŸ“œ åŸºç¡€è®¾æ–½å³ä»£ç ](infrastructure-as-code.md) - Terraformã€Ansibleã€é…ç½®ç®¡ç†
- [ğŸ›¡ï¸ å®‰å…¨å®è·µ](security-practices.md) - DevSecOpsã€å®‰å…¨æ‰«æã€åˆè§„æ£€æŸ¥

</details>

## ğŸ—ï¸ DevOps æ¶æ„æ€»è§ˆ

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "Flutter DevOps æ¶æ„"
        A[å¼€å‘é˜¶æ®µ] --> B[CI/CDæµæ°´çº¿]
        B --> C[æµ‹è¯•é˜¶æ®µ]
        C --> D[éƒ¨ç½²é˜¶æ®µ]
        D --> E[ç›‘æ§é˜¶æ®µ]
        E --> F[è¿ç»´é˜¶æ®µ]
    end

    subgraph "å¼€å‘é˜¶æ®µ"
        A --> G[ä»£ç æäº¤]
        A --> H[ä»£ç å®¡æŸ¥]
        A --> I[åˆ†æ”¯ç®¡ç†]
    end

    subgraph "CI/CDæµæ°´çº¿"
        B --> J[ä»£ç è´¨é‡æ£€æŸ¥]
        B --> K[è‡ªåŠ¨åŒ–æµ‹è¯•]
        B --> L[æ„å»ºæ‰“åŒ…]
        B --> M[éƒ¨ç½²å‘å¸ƒ]
    end

    subgraph "æµ‹è¯•é˜¶æ®µ"
        C --> N[å•å…ƒæµ‹è¯•]
        C --> O[é›†æˆæµ‹è¯•]
        C --> P[UIæµ‹è¯•]
        C --> Q[æ€§èƒ½æµ‹è¯•]
    end

    subgraph "éƒ¨ç½²é˜¶æ®µ"
        D --> R[ç¯å¢ƒç®¡ç†]
        D --> S[ç‰ˆæœ¬æ§åˆ¶]
        D --> T[å›æ»šæœºåˆ¶]
        D --> U[çƒ­æ›´æ–°]
    end

    subgraph "ç›‘æ§é˜¶æ®µ"
        E --> V[æ€§èƒ½ç›‘æ§]
        E --> W[é”™è¯¯è¿½è¸ª]
        E --> X[ç”¨æˆ·åˆ†æ]
        E --> Y[æ—¥å¿—ç®¡ç†]
    end

    subgraph "è¿ç»´é˜¶æ®µ"
        F --> Z[å‘Šè­¦é€šçŸ¥]
        F --> AA[æ•…éšœå¤„ç†]
        F --> BB[å®¹é‡è§„åˆ’]
        F --> CC[å®‰å…¨é˜²æŠ¤]
    end
```

### CI/CD æµæ°´çº¿æ¶æ„

```mermaid
sequenceDiagram
    participant Dev as å¼€å‘è€…
    participant Git as Gitä»“åº“
    participant CI as CI/CDç³»ç»Ÿ
    participant Test as æµ‹è¯•ç¯å¢ƒ
    participant Build as æ„å»ºç³»ç»Ÿ
    participant Deploy as éƒ¨ç½²ç³»ç»Ÿ
    participant Monitor as ç›‘æ§ç³»ç»Ÿ

    Dev->>Git: æäº¤ä»£ç 
    Git->>CI: è§¦å‘æµæ°´çº¿
    CI->>CI: ä»£ç è´¨é‡æ£€æŸ¥
    CI->>Test: è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

    alt æµ‹è¯•é€šè¿‡
        Test-->>CI: æµ‹è¯•ç»“æœ
        CI->>Build: æ„å»ºåº”ç”¨
        Build-->>CI: æ„å»ºäº§ç‰©
        CI->>Deploy: éƒ¨ç½²åˆ°ç¯å¢ƒ
        Deploy-->>CI: éƒ¨ç½²ç»“æœ
        CI->>Monitor: å¯åŠ¨ç›‘æ§
        Monitor-->>Dev: ç›‘æ§æŠ¥å‘Š
    else æµ‹è¯•å¤±è´¥
        Test-->>CI: æµ‹è¯•å¤±è´¥
        CI-->>Dev: å¤±è´¥é€šçŸ¥
    end
```

## ğŸ¯ æ ¸å¿ƒå­¦ä¹ ç›®æ ‡

### ğŸ“š ç†è®ºçŸ¥è¯†

- âœ… æ·±å…¥ç†è§£ DevOps ç†å¿µå’Œå®è·µ
- âœ… æŒæ¡ CI/CD æµæ°´çº¿è®¾è®¡åŸç†
- âœ… äº†è§£è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥å’Œæ–¹æ³•
- âœ… å­¦ä¼šç›‘æ§è¿ç»´å’Œæ€§èƒ½ä¼˜åŒ–

### ğŸ› ï¸ å®è·µæŠ€èƒ½

- âœ… ç†Ÿç»ƒé…ç½® GitHub Actionsã€GitLab CI ç­‰ CI/CD å·¥å…·
- âœ… æŒæ¡è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶å’Œæµ‹è¯•æ–¹æ³•
- âœ… å­¦ä¼šåº”ç”¨åˆ†å‘å’Œç‰ˆæœ¬ç®¡ç†
- âœ… èƒ½å¤Ÿæ­å»ºå®Œæ•´çš„ç›‘æ§ä½“ç³»

### ğŸ¨ æ¶æ„èƒ½åŠ›

- âœ… ç†è§£ DevOps æ¶æ„è®¾è®¡åŸåˆ™
- âœ… æŒæ¡å¾®æœåŠ¡å’Œå®¹å™¨åŒ–éƒ¨ç½²
- âœ… å­¦ä¼šåŸºç¡€è®¾æ–½å³ä»£ç å®è·µ
- âœ… èƒ½å¤Ÿå¤„ç†å¤æ‚çš„è¿ç»´åœºæ™¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ£€æŸ¥ Flutter ç¯å¢ƒ
flutter doctor

# åˆ›å»ºæ–°é¡¹ç›®
flutter create devops_demo
cd devops_demo

# æ·»åŠ ç›¸å…³ä¾èµ–
flutter pub add --dev flutter_test integration_test mockito
flutter pub add --dev flutter_lints dart_code_metrics
flutter pub add firebase_core firebase_crashlytics firebase_analytics
```

### 2. åŸºç¡€ CI/CD é…ç½®

```yaml
# .github/workflows/flutter.yml
name: Flutter CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  FLUTTER_VERSION: "3.16.0"
  JAVA_VERSION: "17"

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥
  quality:
    name: Code Quality
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}

      - name: Install dependencies
        run: flutter pub get

      - name: Analyze code
        run: flutter analyze

      - name: Check formatting
        run: dart format --set-exit-if-changed .

      - name: Run lints
        run: flutter pub run dart_code_metrics:metrics analyze lib

  # å•å…ƒæµ‹è¯•
  test:
    name: Unit Tests
    runs-on: ubuntu-latest
    needs: quality
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}

      - name: Install dependencies
        run: flutter pub get

      - name: Run tests
        run: flutter test --coverage

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: coverage/lcov.info

  # Androidæ„å»º
  build-android:
    name: Build Android
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: "zulu"
          java-version: ${{ env.JAVA_VERSION }}

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}

      - name: Install dependencies
        run: flutter pub get

      - name: Build APK
        run: flutter build apk --release

      - name: Build App Bundle
        run: flutter build appbundle --release

      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: android-artifacts
          path: |
            build/app/outputs/flutter-apk/app-release.apk
            build/app/outputs/bundle/release/app-release.aab

  # iOSæ„å»º
  build-ios:
    name: Build iOS
    runs-on: macos-latest
    needs: test
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}

      - name: Install dependencies
        run: flutter pub get

      - name: Build iOS
        run: |
          flutter build ios --release --no-codesign
          cd ios
          xcodebuild -workspace Runner.xcworkspace \
                     -scheme Runner \
                     -configuration Release \
                     -destination generic/platform=iOS \
                     -archivePath build/Runner.xcarchive \
                     archive
```

### 3. è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®

```dart
// test/widget_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:devops_demo/main.dart';

// Mockç±»ç”Ÿæˆ
import 'widget_test.mocks.dart';

@GenerateMocks([ApiService])
void main() {
  group('App Widget Tests', () {
    late MockApiService mockApiService;

    setUp(() {
      mockApiService = MockApiService();
    });

    testWidgets('Counter increments smoke test', (WidgetTester tester) async {
      // æ„å»ºåº”ç”¨å¹¶è§¦å‘ä¸€å¸§
      await tester.pumpWidget(MyApp());

      // éªŒè¯è®¡æ•°å™¨ä»0å¼€å§‹
      expect(find.text('0'), findsOneWidget);
      expect(find.text('1'), findsNothing);

      // ç‚¹å‡»'+'å›¾æ ‡å¹¶è§¦å‘ä¸€å¸§
      await tester.tap(find.byIcon(Icons.add));
      await tester.pump();

      // éªŒè¯è®¡æ•°å™¨å·²å¢åŠ 
      expect(find.text('0'), findsNothing);
      expect(find.text('1'), findsOneWidget);
    });

    testWidgets('Login form validation', (WidgetTester tester) async {
      await tester.pumpWidget(MaterialApp(
        home: LoginPage(apiService: mockApiService),
      ));

      // æµ‹è¯•ç©ºè¡¨å•æäº¤
      await tester.tap(find.byType(ElevatedButton));
      await tester.pump();

      expect(find.text('è¯·è¾“å…¥é‚®ç®±'), findsOneWidget);
      expect(find.text('è¯·è¾“å…¥å¯†ç '), findsOneWidget);

      // æµ‹è¯•æœ‰æ•ˆè¾“å…¥
      await tester.enterText(find.byType(TextField).first, 'test@example.com');
      await tester.enterText(find.byType(TextField).last, 'password123');

      when(mockApiService.login(any, any))
          .thenAnswer((_) async => LoginResult.success());

      await tester.tap(find.byType(ElevatedButton));
      await tester.pump();

      verify(mockApiService.login('test@example.com', 'password123')).called(1);
    });
  });
}

// é›†æˆæµ‹è¯•
// integration_test/app_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:devops_demo/main.dart' as app;

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('ç«¯åˆ°ç«¯æµ‹è¯•', () {
    testWidgets('å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•', (WidgetTester tester) async {
      app.main();
      await tester.pumpAndSettle();

      // 1. å¯åŠ¨é¡µé¢
      expect(find.text('æ¬¢è¿'), findsOneWidget);

      // 2. å¯¼èˆªåˆ°ç™»å½•é¡µé¢
      await tester.tap(find.text('ç™»å½•'));
      await tester.pumpAndSettle();

      // 3. æ‰§è¡Œç™»å½•
      await tester.enterText(
        find.byKey(const Key('email_field')),
        'test@example.com',
      );
      await tester.enterText(
        find.byKey(const Key('password_field')),
        'password123',
      );

      await tester.tap(find.byKey(const Key('login_button')));
      await tester.pumpAndSettle(const Duration(seconds: 3));

      // 4. éªŒè¯ç™»å½•æˆåŠŸ
      expect(find.text('ä¸»é¡µ'), findsOneWidget);

      // 5. æµ‹è¯•ä¸»è¦åŠŸèƒ½
      await tester.tap(find.byIcon(Icons.add));
      await tester.pumpAndSettle();

      expect(find.text('æ–°å»º'), findsOneWidget);

      // 6. é€€å‡ºç™»å½•
      await tester.tap(find.byIcon(Icons.logout));
      await tester.pumpAndSettle();

      expect(find.text('æ¬¢è¿'), findsOneWidget);
    });

    testWidgets('æ€§èƒ½æµ‹è¯•', (WidgetTester tester) async {
      app.main();
      await tester.pumpAndSettle();

      // æµ‹è¯•é¡µé¢åŠ è½½æ€§èƒ½
      final stopwatch = Stopwatch()..start();

      await tester.tap(find.text('å•†å“åˆ—è¡¨'));
      await tester.pumpAndSettle();

      stopwatch.stop();

      // éªŒè¯é¡µé¢åŠ è½½æ—¶é—´å°äº2ç§’
      expect(stopwatch.elapsedMilliseconds, lessThan(2000));

      // æµ‹è¯•æ»šåŠ¨æ€§èƒ½
      final listFinder = find.byType(ListView);
      expect(listFinder, findsOneWidget);

      // å¿«é€Ÿæ»šåŠ¨æµ‹è¯•
      await tester.fling(listFinder, const Offset(0, -500), 1000);
      await tester.pumpAndSettle();

      // éªŒè¯æ»šåŠ¨åUIæ­£å¸¸
      expect(find.byType(ListTile), findsWidgets);
    });
  });
}
```

### 4. ç›‘æ§é…ç½®ç¤ºä¾‹

```dart
// lib/main.dart
import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:firebase_crashlytics/firebase_crashlytics.dart';
import 'package:firebase_analytics/firebase_analytics.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  await Firebase.initializeApp();

  // é…ç½®Crashlytics
  FlutterError.onError = (errorDetails) {
    FirebaseCrashlytics.instance.recordFlutterFatalError(errorDetails);
  };

  // é…ç½®Analytics
  FirebaseAnalytics analytics = FirebaseAnalytics.instance;

  runApp(MyApp(analytics: analytics));
}

class MyApp extends StatelessWidget {
  final FirebaseAnalytics analytics;

  const MyApp({Key? key, required this.analytics}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'DevOps Demo',
      navigatorObservers: [
        FirebaseAnalyticsObserver(analytics: analytics),
      ],
      home: const MyHomePage(),
    );
  }
}

// lib/utils/logger.dart
import 'package:logger/logger.dart';
import 'package:firebase_crashlytics/firebase_crashlytics.dart';

class AppLogger {
  static final Logger _logger = Logger(
    printer: PrettyPrinter(
      methodCount: 2,
      errorMethodCount: 8,
      lineLength: 120,
      colors: true,
      printEmojis: true,
      printTime: true,
    ),
  );

  static void debug(String message, [dynamic error, StackTrace? stackTrace]) {
    _logger.d(message, error, stackTrace);
  }

  static void info(String message, [dynamic error, StackTrace? stackTrace]) {
    _logger.i(message, error, stackTrace);
  }

  static void warning(String message, [dynamic error, StackTrace? stackTrace]) {
    _logger.w(message, error, stackTrace);
  }

  static void error(String message, [dynamic error, StackTrace? stackTrace]) {
    _logger.e(message, error, stackTrace);

    // å‘é€åˆ°Crashlytics
    FirebaseCrashlytics.instance.recordError(
      error ?? message,
      stackTrace,
      reason: message,
    );
  }

  static void fatal(String message, [dynamic error, StackTrace? stackTrace]) {
    _logger.f(message, error, stackTrace);

    // å‘é€è‡´å‘½é”™è¯¯åˆ°Crashlytics
    FirebaseCrashlytics.instance.recordError(
      error ?? message,
      stackTrace,
      reason: message,
      fatal: true,
    );
  }
}

// lib/utils/performance_monitor.dart
import 'package:firebase_performance/firebase_performance.dart';

class PerformanceMonitor {
  static final FirebasePerformance _performance = FirebasePerformance.instance;

  // ç›‘æ§HTTPè¯·æ±‚
  static Future<T> monitorHttpRequest<T>(
    String url,
    Future<T> Function() request,
  ) async {
    final trace = _performance.newHttpTrace(
      url: url,
      httpMethod: HttpMethod.Get,
    );

    await trace.start();

    try {
      final result = await request();
      trace.setHttpResponseCode(200);
      return result;
    } catch (e) {
      trace.setHttpResponseCode(500);
      rethrow;
    } finally {
      await trace.stop();
    }
  }

  // ç›‘æ§è‡ªå®šä¹‰æ“ä½œ
  static Future<T> monitorOperation<T>(
    String operationName,
    Future<T> Function() operation, {
    Map<String, String>? attributes,
  }) async {
    final trace = _performance.newTrace(operationName);

    if (attributes != null) {
      attributes.forEach((key, value) {
        trace.putAttribute(key, value);
      });
    }

    await trace.start();

    try {
      return await operation();
    } finally {
      await trace.stop();
    }
  }

  // ç›‘æ§é¡µé¢åŠ è½½æ—¶é—´
  static Trace startPageTrace(String pageName) {
    final trace = _performance.newTrace('page_load_$pageName');
    trace.start();
    return trace;
  }
}
```

## ğŸ“Š DevOps å·¥å…·å¯¹æ¯”

### CI/CD å·¥å…·å¯¹æ¯”

| å·¥å…·           | å­¦ä¹ æˆæœ¬ | åŠŸèƒ½ä¸°å¯Œåº¦ | é›†æˆéš¾åº¦   | ç¤¾åŒºæ”¯æŒ   | é€‚ç”¨åœºæ™¯             |
| -------------- | -------- | ---------- | ---------- | ---------- | -------------------- |
| GitHub Actions | â­â­â­   | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å¼€æºé¡¹ç›®ã€å°å›¢é˜Ÿ     |
| GitLab CI      | â­â­â­â­ | â­â­â­â­   | â­â­â­â­   | â­â­â­â­   | ä¼ä¸šçº§ã€ç§æœ‰éƒ¨ç½²     |
| Jenkins        | â­â­     | â­â­â­â­â­ | â­â­       | â­â­â­â­â­ | å¤§å‹ä¼ä¸šã€å¤æ‚æµæ°´çº¿ |
| CircleCI       | â­â­â­   | â­â­â­â­   | â­â­â­â­   | â­â­â­     | äº‘åŸç”Ÿã€å¿«é€Ÿéƒ¨ç½²     |
| Azure DevOps   | â­â­â­   | â­â­â­â­   | â­â­â­     | â­â­â­     | å¾®è½¯ç”Ÿæ€ã€ä¼ä¸šçº§     |

### æµ‹è¯•å·¥å…·å¯¹æ¯”

| å·¥å…·ç±»å‹  | å·¥å…·åç§°         | é€‚ç”¨åœºæ™¯              | ä¼˜åŠ¿               | åŠ£åŠ¿         |
| --------- | ---------------- | --------------------- | ------------------ | ------------ |
| å•å…ƒæµ‹è¯•  | Flutter Test     | Widget æµ‹è¯•ã€é€»è¾‘æµ‹è¯• | å®˜æ–¹æ”¯æŒã€é›†æˆåº¦é«˜ | åŠŸèƒ½ç›¸å¯¹ç®€å• |
| Mock æµ‹è¯• | Mockito          | ä¾èµ–éš”ç¦»ã€æµ‹è¯•é©±åŠ¨    | åŠŸèƒ½å¼ºå¤§ã€ç±»å‹å®‰å…¨ | å­¦ä¹ æˆæœ¬è¾ƒé«˜ |
| é›†æˆæµ‹è¯•  | Integration Test | ç«¯åˆ°ç«¯æµ‹è¯•            | çœŸå®ç¯å¢ƒã€å®Œæ•´æµç¨‹ | æ‰§è¡Œæ—¶é—´é•¿   |
| UI æµ‹è¯•   | Patrol           | è‡ªåŠ¨åŒ– UI æµ‹è¯•        | è·¨å¹³å°ã€æ˜“ç”¨æ€§     | ç¤¾åŒºç›¸å¯¹è¾ƒå° |

### ç›‘æ§å·¥å…·å¯¹æ¯”

| å·¥å…·      | åŠŸèƒ½     | é›†æˆéš¾åº¦   | æˆæœ¬     | é€‚ç”¨åœºæ™¯           |
| --------- | -------- | ---------- | -------- | ------------------ |
| Firebase  | å…¨é¢ç›‘æ§ | â­â­â­â­â­ | å…è´¹èµ·æ­¥ | å¿«é€Ÿé›†æˆã€å°é¡¹ç›®   |
| Sentry    | é”™è¯¯è¿½è¸ª | â­â­â­â­   | ä¸­ç­‰     | é”™è¯¯ç›‘æ§ã€æ€§èƒ½åˆ†æ |
| New Relic | APM ç›‘æ§ | â­â­â­     | è¾ƒé«˜     | ä¼ä¸šçº§ã€å¤æ‚åº”ç”¨   |
| DataDog   | å…¨æ ˆç›‘æ§ | â­â­â­     | è¾ƒé«˜     | å¤§å‹ä¼ä¸šã€å¾®æœåŠ¡   |

## ğŸ¨ è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. æµæ°´çº¿æ¨¡å¼ (Pipeline Pattern)

```dart
// CI/CDæµæ°´çº¿æŠ½è±¡
abstract class PipelineStage {
  String get name;
  Future<bool> execute(PipelineContext context);
}

class PipelineContext {
  final Map<String, dynamic> data = {};
  final List<String> logs = [];

  void addData(String key, dynamic value) {
    data[key] = value;
  }

  T? getData<T>(String key) {
    return data[key] as T?;
  }

  void addLog(String message) {
    logs.add('${DateTime.now()}: $message');
  }
}

// å…·ä½“æµæ°´çº¿é˜¶æ®µ
class CodeQualityStage extends PipelineStage {
  @override
  String get name => 'Code Quality';

  @override
  Future<bool> execute(PipelineContext context) async {
    try {
      context.addLog('å¼€å§‹ä»£ç è´¨é‡æ£€æŸ¥');

      // è¿è¡Œä»£ç åˆ†æ
      final result = await Process.run('flutter', ['analyze']);

      if (result.exitCode == 0) {
        context.addLog('ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡');
        context.addData('codeQuality', 'passed');
        return true;
      } else {
        context.addLog('ä»£ç è´¨é‡æ£€æŸ¥å¤±è´¥: ${result.stderr}');
        context.addData('codeQuality', 'failed');
        return false;
      }
    } catch (e) {
      context.addLog('ä»£ç è´¨é‡æ£€æŸ¥å¼‚å¸¸: $e');
      return false;
    }
  }
}

class TestStage extends PipelineStage {
  @override
  String get name => 'Testing';

  @override
  Future<bool> execute(PipelineContext context) async {
    try {
      context.addLog('å¼€å§‹è¿è¡Œæµ‹è¯•');

      // è¿è¡Œå•å…ƒæµ‹è¯•
      final testResult = await Process.run('flutter', ['test', '--coverage']);

      if (testResult.exitCode == 0) {
        context.addLog('æµ‹è¯•é€šè¿‡');
        context.addData('testResult', 'passed');
        return true;
      } else {
        context.addLog('æµ‹è¯•å¤±è´¥: ${testResult.stderr}');
        context.addData('testResult', 'failed');
        return false;
      }
    } catch (e) {
      context.addLog('æµ‹è¯•å¼‚å¸¸: $e');
      return false;
    }
  }
}

class BuildStage extends PipelineStage {
  @override
  String get name => 'Building';

  @override
  Future<bool> execute(PipelineContext context) async {
    try {
      context.addLog('å¼€å§‹æ„å»ºåº”ç”¨');

      // æ„å»ºAndroid APK
      final buildResult = await Process.run('flutter', ['build', 'apk', '--release']);

      if (buildResult.exitCode == 0) {
        context.addLog('æ„å»ºæˆåŠŸ');
        context.addData('buildResult', 'success');
        return true;
      } else {
        context.addLog('æ„å»ºå¤±è´¥: ${buildResult.stderr}');
        context.addData('buildResult', 'failed');
        return false;
      }
    } catch (e) {
      context.addLog('æ„å»ºå¼‚å¸¸: $e');
      return false;
    }
  }
}

// æµæ°´çº¿æ‰§è¡Œå™¨
class PipelineExecutor {
  final List<PipelineStage> stages;

  PipelineExecutor(this.stages);

  Future<bool> execute() async {
    final context = PipelineContext();

    for (final stage in stages) {
      context.addLog('æ‰§è¡Œé˜¶æ®µ: ${stage.name}');

      final success = await stage.execute(context);

      if (!success) {
        context.addLog('é˜¶æ®µå¤±è´¥: ${stage.name}');
        return false;
      }

      context.addLog('é˜¶æ®µå®Œæˆ: ${stage.name}');
    }

    context.addLog('æ‰€æœ‰é˜¶æ®µæ‰§è¡Œå®Œæˆ');
    return true;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
void main() async {
  final pipeline = PipelineExecutor([
    CodeQualityStage(),
    TestStage(),
    BuildStage(),
  ]);

  final success = await pipeline.execute();

  if (success) {
    print('æµæ°´çº¿æ‰§è¡ŒæˆåŠŸ');
  } else {
    print('æµæ°´çº¿æ‰§è¡Œå¤±è´¥');
  }
}
```

### 2. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)

```dart
// éƒ¨ç½²çŠ¶æ€ç›‘å¬å™¨
class DeploymentObserver extends ChangeNotifier {
  final Map<String, DeploymentStatus> _deployments = {};

  DeploymentStatus getDeploymentStatus(String deploymentId) {
    return _deployments[deploymentId] ?? DeploymentStatus.unknown;
  }

  void updateDeploymentStatus(String deploymentId, DeploymentStatus status) {
    _deployments[deploymentId] = status;
    notifyListeners();

    // è®°å½•éƒ¨ç½²çŠ¶æ€å˜åŒ–
    _logDeploymentStatus(deploymentId, status);
  }

  void _logDeploymentStatus(String deploymentId, DeploymentStatus status) {
    print('éƒ¨ç½²çŠ¶æ€æ›´æ–°: $deploymentId -> $status');
  }
}

enum DeploymentStatus { pending, inProgress, success, failed, unknown }

// éƒ¨ç½²ç®¡ç†å™¨
class DeploymentManager {
  final DeploymentObserver _observer = DeploymentObserver();

  Future<void> deploy(String deploymentId, String version) async {
    _observer.updateDeploymentStatus(deploymentId, DeploymentStatus.pending);

    try {
      _observer.updateDeploymentStatus(deploymentId, DeploymentStatus.inProgress);

      // æ‰§è¡Œéƒ¨ç½²é€»è¾‘
      await _performDeployment(version);

      _observer.updateDeploymentStatus(deploymentId, DeploymentStatus.success);
    } catch (e) {
      _observer.updateDeploymentStatus(deploymentId, DeploymentStatus.failed);
      rethrow;
    }
  }

  Future<void> _performDeployment(String version) async {
    // æ¨¡æ‹Ÿéƒ¨ç½²è¿‡ç¨‹
    await Future.delayed(Duration(seconds: 5));
  }

  void watchDeployment(String deploymentId, Function(DeploymentStatus) callback) {
    _observer.addListener(() {
      final status = _observer.getDeploymentStatus(deploymentId);
      callback(status);
    });
  }
}
```

### 3. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)

```dart
// éƒ¨ç½²ç­–ç•¥æ¥å£
abstract class DeploymentStrategy {
  String get name;
  Future<bool> deploy(String version, Map<String, dynamic> config);
  Future<bool> rollback(String version);
}

// Androidéƒ¨ç½²ç­–ç•¥
class AndroidDeploymentStrategy implements DeploymentStrategy {
  @override
  String get name => 'Android';

  @override
  Future<bool> deploy(String version, Map<String, dynamic> config) async {
    try {
      print('éƒ¨ç½²Androidç‰ˆæœ¬: $version');

      // æ„å»ºAPK
      await Process.run('flutter', ['build', 'apk', '--release']);

      // ä¸Šä¼ åˆ°Google Play Console
      await _uploadToPlayStore(version, config);

      return true;
    } catch (e) {
      print('Androidéƒ¨ç½²å¤±è´¥: $e');
      return false;
    }
  }

  @override
  Future<bool> rollback(String version) async {
    try {
      print('å›æ»šAndroidç‰ˆæœ¬: $version');
      // å®ç°å›æ»šé€»è¾‘
      return true;
    } catch (e) {
      print('Androidå›æ»šå¤±è´¥: $e');
      return false;
    }
  }

  Future<void> _uploadToPlayStore(String version, Map<String, dynamic> config) async {
    // å®ç°ä¸Šä¼ é€»è¾‘
  }
}

// iOSéƒ¨ç½²ç­–ç•¥
class IOSDeploymentStrategy implements DeploymentStrategy {
  @override
  String get name => 'iOS';

  @override
  Future<bool> deploy(String version, Map<String, dynamic> config) async {
    try {
      print('éƒ¨ç½²iOSç‰ˆæœ¬: $version');

      // æ„å»ºiOSåº”ç”¨
      await Process.run('flutter', ['build', 'ios', '--release']);

      // ä¸Šä¼ åˆ°App Store Connect
      await _uploadToAppStore(version, config);

      return true;
    } catch (e) {
      print('iOSéƒ¨ç½²å¤±è´¥: $e');
      return false;
    }
  }

  @override
  Future<bool> rollback(String version) async {
    try {
      print('å›æ»šiOSç‰ˆæœ¬: $version');
      // å®ç°å›æ»šé€»è¾‘
      return true;
    } catch (e) {
      print('iOSå›æ»šå¤±è´¥: $e');
      return false;
    }
  }

  Future<void> _uploadToAppStore(String version, Map<String, dynamic> config) async {
    // å®ç°ä¸Šä¼ é€»è¾‘
  }
}

// éƒ¨ç½²ç­–ç•¥å·¥å‚
class DeploymentStrategyFactory {
  static DeploymentStrategy createStrategy(String platform) {
    switch (platform.toLowerCase()) {
      case 'android':
        return AndroidDeploymentStrategy();
      case 'ios':
        return IOSDeploymentStrategy();
      default:
        throw ArgumentError('ä¸æ”¯æŒçš„å¹³å°: $platform');
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
class DeploymentService {
  Future<void> deployToPlatform(String platform, String version) async {
    final strategy = DeploymentStrategyFactory.createStrategy(platform);

    final config = {
      'releaseNotes': 'æ–°ç‰ˆæœ¬å‘å¸ƒ',
      'targetAudience': 'all',
    };

    final success = await strategy.deploy(version, config);

    if (success) {
      print('${strategy.name} éƒ¨ç½²æˆåŠŸ');
    } else {
      print('${strategy.name} éƒ¨ç½²å¤±è´¥');
    }
  }
}
```

## ğŸ”§ å¼€å‘å·¥å…·æ¨è

### ğŸ“± è°ƒè¯•å·¥å…·

- **Flutter Inspector**: åº”ç”¨è°ƒè¯•
- **Dart DevTools**: æ€§èƒ½åˆ†æ
- **Firebase Console**: ç›‘æ§åˆ†æ
- **Sentry Dashboard**: é”™è¯¯è¿½è¸ª

### ğŸ¨ è®¾è®¡å·¥å…·

- **GitHub Actions**: CI/CD æµæ°´çº¿
- **GitLab CI**: ä¼ä¸šçº§ CI/CD
- **Jenkins**: ä¼ ç»Ÿ CI/CD
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²

### ğŸ“š å­¦ä¹ èµ„æº

- **å®˜æ–¹æ–‡æ¡£**: å„å·¥å…·çš„å®˜æ–¹æ–‡æ¡£
- **GitHub ç¤ºä¾‹**: å®˜æ–¹ç¤ºä¾‹é¡¹ç›®
- **ç¤¾åŒºåšå®¢**: æŠ€æœ¯åšå®¢å’Œæ•™ç¨‹

## ğŸ“ˆ å­¦ä¹ è·¯å¾„å»ºè®®

```mermaid
graph TD
    A[å¼€å§‹å­¦ä¹ ] --> B[DevOpsåŸºç¡€]
    B --> C[CI/CDæµæ°´çº¿]
    C --> D[è‡ªåŠ¨åŒ–æµ‹è¯•]
    D --> E[åº”ç”¨åˆ†å‘]
    E --> F[ç›‘æ§è¿ç»´]
    F --> G[åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–]
    G --> H[å®‰å…¨å®è·µ]
    H --> I[é«˜çº§DevOps]
```

### ğŸ¯ é˜¶æ®µç›®æ ‡

#### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æŒæ¡

- [ ] ç†è§£ DevOps åŸºç¡€æ¦‚å¿µ
- [ ] æŒæ¡ Git å’Œåˆ†æ”¯ç®¡ç†
- [ ] å­¦ä¼šåŸºç¡€ CI/CD é…ç½®
- [ ] å®Œæˆç®€å•çš„è‡ªåŠ¨åŒ–éƒ¨ç½²

#### ç¬¬äºŒé˜¶æ®µï¼šè¿›é˜¶å­¦ä¹ 

- [ ] æ·±å…¥å­¦ä¹ è‡ªåŠ¨åŒ–æµ‹è¯•
- [ ] æŒæ¡åº”ç”¨åˆ†å‘æµç¨‹
- [ ] å­¦ä¼šç›‘æ§å’Œæ—¥å¿—ç®¡ç†
- [ ] å®Œæˆä¸­ç­‰å¤æ‚åº¦çš„ DevOps æµç¨‹

#### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åº”ç”¨

- [ ] æŒæ¡åŸºç¡€è®¾æ–½å³ä»£ç 
- [ ] å­¦ä¼šå®¹å™¨åŒ–å’Œå¾®æœåŠ¡
- [ ] ç†è§£å®‰å…¨æœ€ä½³å®è·µ
- [ ] å®Œæˆä¼ä¸šçº§ DevOps æ¶æ„

#### ç¬¬å››é˜¶æ®µï¼šå®æˆ˜é¡¹ç›®

- [ ] å®Œæˆå®Œæ•´çš„å•†ä¸šçº§ DevOps æµç¨‹
- [ ] æŒæ¡å›¢é˜Ÿåä½œå’Œæµç¨‹ä¼˜åŒ–
- [ ] å­¦ä¼šæ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœå¤„ç†
- [ ] å‚ä¸å¼€æºé¡¹ç›®è´¡çŒ®

## ğŸ† æœ€ä½³å®è·µ

### ğŸ“ ä»£ç è§„èŒƒ

```dart
// âœ… æ¨èï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†
class DevOpsService {
  static Future<T> safeExecute<T>(
    Future<T> Function() operation,
    String operationName,
  ) async {
    try {
      return await operation();
    } on ProcessException catch (e) {
      print('è¿›ç¨‹æ‰§è¡Œé”™è¯¯ [$operationName]: $e');
      throw DevOpsException('è¿›ç¨‹æ‰§è¡Œå¤±è´¥: $e');
    } on FileSystemException catch (e) {
      print('æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ [$operationName]: $e');
      throw DevOpsException('æ–‡ä»¶æ“ä½œå¤±è´¥: $e');
    } catch (e) {
      print('æœªçŸ¥é”™è¯¯ [$operationName]: $e');
      throw DevOpsException('æ“ä½œå¤±è´¥: $e');
    }
  }
}

class DevOpsException implements Exception {
  final String message;

  DevOpsException(this.message);

  @override
  String toString() => 'DevOpsException: $message';
}

// âœ… æ¨èï¼šé…ç½®ç®¡ç†
class DevOpsConfig {
  final String flutterVersion;
  final String javaVersion;
  final Map<String, String> environment;
  final List<String> testCommands;
  final Map<String, dynamic> buildConfig;

  DevOpsConfig({
    required this.flutterVersion,
    required this.javaVersion,
    required this.environment,
    required this.testCommands,
    required this.buildConfig,
  });

  factory DevOpsConfig.fromJson(Map<String, dynamic> json) {
    return DevOpsConfig(
      flutterVersion: json['flutterVersion'] as String,
      javaVersion: json['javaVersion'] as String,
      environment: Map<String, String>.from(json['environment'] as Map),
      testCommands: List<String>.from(json['testCommands'] as List),
      buildConfig: json['buildConfig'] as Map<String, dynamic>,
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'flutterVersion': flutterVersion,
      'javaVersion': javaVersion,
      'environment': environment,
      'testCommands': testCommands,
      'buildConfig': buildConfig,
    };
  }
}
```

### ğŸ¨ æ¶æ„åŸåˆ™

- **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: å°½å¯èƒ½è‡ªåŠ¨åŒ–é‡å¤æ€§å·¥ä½œ
- **æŒç»­æ”¹è¿›**: ä¸æ–­ä¼˜åŒ–æµç¨‹å’Œå·¥å…·
- **ç›‘æ§é©±åŠ¨**: åŸºäºç›‘æ§æ•°æ®è¿›è¡Œå†³ç­–
- **å®‰å…¨å·¦ç§»**: åœ¨å¼€å‘æ—©æœŸè€ƒè™‘å®‰å…¨é—®é¢˜

### âš¡ æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ç¼“å­˜å‡å°‘æ„å»ºæ—¶é—´
- å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹ä»»åŠ¡
- ä¼˜åŒ–æµ‹è¯•æ‰§è¡Œç­–ç•¥
- åˆç†ä½¿ç”¨èµ„æºé™åˆ¶

### ğŸ§ª æµ‹è¯•ç­–ç•¥

- DevOps æµç¨‹æµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%
- è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–å…³é”®æµç¨‹
- å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ“š ç›¸å…³èµ„æº

### ğŸ”— å®˜æ–¹èµ„æº

- [Flutter å®˜æ–¹æ–‡æ¡£](https://flutter.dev/docs)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Firebase æ–‡æ¡£](https://firebase.google.com/docs)
- [Sentry æ–‡æ¡£](https://docs.sentry.io/)

### ğŸ“– æ¨èä¹¦ç±

- ã€ŠFlutter å®æˆ˜ã€‹
- ã€ŠDevOps å®è·µæŒ‡å—ã€‹
- ã€ŠæŒç»­äº¤ä»˜ã€‹

### ğŸ¥ è§†é¢‘æ•™ç¨‹

- [Flutter å®˜æ–¹ YouTube é¢‘é“](https://www.youtube.com/c/FlutterDev)
- [B ç«™ Flutter æ•™ç¨‹](https://www.bilibili.com/video/BV1S4411E7LY)

---

## ğŸ‰ å¼€å§‹ä½ çš„ DevOps ä¹‹æ—…

ç°åœ¨ä½ å·²ç»äº†è§£äº† Flutter DevOps çš„æ•´ä½“æ¶æ„å’Œå­¦ä¹ è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä»[æŒç»­é›†æˆ](continuous-integration.md)å¼€å§‹ï¼Œé€æ­¥æŒæ¡å„ç§ DevOps å®è·µã€‚

è®°ä½ï¼š**DevOps æ˜¯ä¸€ç§æ–‡åŒ–ï¼Œè€Œä¸ä»…ä»…æ˜¯å·¥å…·å’Œæµç¨‹**ï¼Œæ³¨é‡å›¢é˜Ÿåä½œå’ŒæŒç»­æ”¹è¿›ï¼

---

<div align="center">

**ğŸŒŸ å¦‚æœè¿™ä¸ªæŒ‡å—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star æ”¯æŒä¸€ä¸‹ï¼ ğŸŒŸ**

[![GitHub stars](https://img.shields.io/github/stars/1989allen126/language-tutorial?style=social)](https://github.com/1989allen126/language-tutorial)
[![GitHub forks](https://img.shields.io/github/forks/1989allen126/language-tutorial?style=social)](https://github.com/1989allen126/language-tutorial)

</div>
